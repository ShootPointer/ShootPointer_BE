


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > HighlightManager</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.midas.shootpointer.domain.highlight.business</a>
</div>

<h1>Coverage Summary for Class: HighlightManager (com.midas.shootpointer.domain.highlight.business)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">HighlightManager</td>
<td class="coverageStat">
  <span class="percent">
    33.3%
  </span>
  <span class="absValue">
    (1/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    6.7%
  </span>
  <span class="absValue">
    (1/15)
  </span>
</td>
</tr>
  <tr>
    <td class="name">HighlightManager$$SpringCGLIB$$0</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    33.3%
  </span>
  <span class="absValue">
    (1/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    6.7%
  </span>
  <span class="absValue">
    (1/15)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.midas.shootpointer.domain.highlight.business;
&nbsp;
&nbsp;import com.midas.shootpointer.domain.highlight.dto.HighlightResponse;
&nbsp;import com.midas.shootpointer.domain.highlight.dto.HighlightSelectRequest;
&nbsp;import com.midas.shootpointer.domain.highlight.dto.HighlightSelectResponse;
&nbsp;import com.midas.shootpointer.domain.highlight.dto.UploadHighlight;
&nbsp;import com.midas.shootpointer.domain.highlight.entity.HighlightEntity;
&nbsp;import com.midas.shootpointer.domain.highlight.helper.HighlightHelper;
&nbsp;import com.midas.shootpointer.domain.highlight.mapper.HighlightFactory;
&nbsp;import com.midas.shootpointer.domain.highlight.mapper.HighlightMapper;
&nbsp;import com.midas.shootpointer.domain.highlight.service.HighlightStorageService;
&nbsp;import com.midas.shootpointer.domain.member.entity.Member;
&nbsp;import com.midas.shootpointer.domain.member.helper.MemberHelper;
&nbsp;import com.midas.shootpointer.global.annotation.CustomLog;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.stereotype.Component;
&nbsp;import org.springframework.transaction.annotation.Transactional;
&nbsp;import org.springframework.web.multipart.MultipartFile;
&nbsp;
&nbsp;import java.util.List;
&nbsp;import java.util.UUID;
&nbsp;
&nbsp;@Component
&nbsp;@RequiredArgsConstructor
<b class="fc">&nbsp;@Slf4j</b>
&nbsp;public class HighlightManager {
&nbsp;    private final HighlightHelper highlightHelper;
&nbsp;    private final HighlightStorageService highlightStorageService;
&nbsp;    private final HighlightMapper mapper;
&nbsp;    private final HighlightFactory factory;
&nbsp;    private final MemberHelper memberHelper;
&nbsp;
&nbsp;    /*==========================
&nbsp;    *
&nbsp;    *HighlightManager
&nbsp;    * 여러개의 하이라이트 영상 중 유저가 선택하는 메서드
&nbsp;    * @parm request : 요청 dto memberId : 멤버 Id
&nbsp;    * @return 선택된 하이라이트 영상 Id 리스트
&nbsp;    * @author kimdoyeon
&nbsp;    * @version 1.0.0
&nbsp;    * @date 25. 10. 7.
&nbsp;    *
&nbsp;    ==========================**/
&nbsp;    @Transactional
&nbsp;    @CustomLog
&nbsp;    public HighlightSelectResponse selectHighlight(HighlightSelectRequest request, Member member){
<b class="nc">&nbsp;        List&lt;UUID&gt; selectedIds=request.getSelectedHighlightIds();</b>
&nbsp;        /**
&nbsp;         * 1. 유저가 선택 요청한 하이라이트 Id 리스트 -&gt; 엔티티로 가져오기
&nbsp;         */
<b class="nc">&nbsp;        List&lt;HighlightEntity&gt; highlights = selectedIds.stream()</b>
<b class="nc">&nbsp;                .map(highlightHelper::findHighlightByHighlightId)</b>
<b class="nc">&nbsp;                .toList();</b>
&nbsp;
&nbsp;        /*
&nbsp;         * 2. 선택 수행
&nbsp;         */
<b class="nc">&nbsp;        highlights.forEach(entity -&gt; entity.select(member));</b>
&nbsp;
<b class="nc">&nbsp;        return mapper.entityToResponse(selectedIds);</b>
&nbsp;    }
&nbsp;
&nbsp;    /*==========================
&nbsp;    *
&nbsp;    *HighlightManager
&nbsp;    * 1. openCv 에서 생성한 하이라이트 영상들을 비디오 디렉토리에 저장.
&nbsp;    * 2. PostgreSQL 디렉토리 URL 및 하이라이트 정보 저장.
&nbsp;    * @parm
&nbsp;    * @return
&nbsp;    * @author kimdoyeon
&nbsp;    * @version 1.0.0
&nbsp;    * @date 25. 10. 7.
&nbsp;    *
&nbsp;    ==========================**/
&nbsp;    @CustomLog
&nbsp;    @Transactional
&nbsp;    public List&lt;HighlightResponse&gt; uploadHighlights(
&nbsp;            UploadHighlight request,
&nbsp;            List&lt;MultipartFile&gt; highlights,
&nbsp;            UUID memberId
&nbsp;    ) {
&nbsp;        /**
&nbsp;         * 1. 파일 크기 및 파일 형식 검사
&nbsp;         */
<b class="nc">&nbsp;        highlightHelper.areValidFiles(highlights);</b>
&nbsp;
&nbsp;        /**
&nbsp;         * 2. 하이라이트 키 / 디렉토리 -&gt; 하이라이트 엔티티 저장
&nbsp;         */
<b class="nc">&nbsp;        List&lt;String&gt; storedFiles=highlightStorageService.storeHighlights(highlights,request.getHighlightKey());</b>
&nbsp;
&nbsp;        /*
&nbsp;        *   3. 하이라이트 엔티티 생성
&nbsp;         */
<b class="nc">&nbsp;        Member member=memberHelper.findMemberById(memberId);</b>
<b class="nc">&nbsp;        List&lt;HighlightEntity&gt; entities=factory.createHighlightEntities(storedFiles,request.getHighlightKey(),member);</b>
&nbsp;
&nbsp;        /*
&nbsp;            4. DB 저장
&nbsp;         */
<b class="nc">&nbsp;        List&lt;HighlightEntity&gt; savedEntities = highlightHelper.savedAll(entities);</b>
&nbsp;
<b class="nc">&nbsp;        return savedEntities.stream()</b>
<b class="nc">&nbsp;                .map(mapper::entityToResponse)</b>
<b class="nc">&nbsp;                .toList();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-10-23 11:21</div>
</div>
</body>
</html>
